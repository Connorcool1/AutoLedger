@page
@model ProcessFileModel
@{
    ViewData["Title"] = "Home page";
}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">        
            <h1>Select items to download: </h1>
            @if (Model.Message != null)
            {
                <div class="alert alert-info alert-dismissible fade show mt-4" role="alert">
                    @Model.Message
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            }
            
            @if (Model.ParsedItems != null && Model.ParsedItems.Count > 0)
            {
                <div class="mt-4">
                    <div>
                        <h4 class="mb-0">Total Transactions (@Model.ParsedItems.Count)</h4>        
                    </div>
                    <div class="d-flex flex-column mb-3" style="min-height: 80px;">
                        <div class="d-flex justify-content-between mt-auto">
                            <div class="d-flex gap-2 mt-auto">
                                <span id="selectAll" class="select-all">Select All</span>
                                <span id="deselectAll" class="select-all">Deselect All</span>
                            </div>
                            <div>
                                <button type="submit" form="filterForm" class="btn btn-success btn-lg" id="filterBtn">
                                    Confirm
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th></th>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th>Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                <form method="post" asp-page-handler="Filter" id="filterForm">
                                    @for(int i = 0; i < Model.ParsedItems.Count; i++)
                                    {
                                        var item = Model.ParsedItems[i];
                                        <tr>
                                            <td><input class ="item-checkbox" type="checkbox" name ="selectedIndices" value="@item.Id" id="item_@item.Id" /></td>
                                            <td>@item.Date.ToString("dd/MM/yyyy")</td>
                                            <td>@item.Description</td>
                                            <td>Â£@item.Amount.ToString("F2")</td>
                                        </tr>
                                    }
                                </form>
                            </tbody>
                        </table>
                    </div>
                </div>
            }
        </div>
    </div>
</div>



<style>
    .drop-zone {
        border: 3px dashed #dee2e6;
        transition: all 0.3s ease;
    }
    
    .drop-zone.drag-over {
        background-color: #e7f1ff !important;
        border-color: #0d6efd !important;
        box-shadow: 0 0 15px rgba(13, 110, 253, 0.2);
    }
    
    .drop-zone-content {
        pointer-events: none;
    }

    .form-check-input:checked {
        background-color: #198754;
        border-color: #198754;
    }

    .form-check-input:checked:focus {
        border-color: #198754;
        box-shadow: 0 0 0 0.25rem rgba(25, 135, 84, 0.25);
    }

    .select-all {
        text-decoration: underline;
        cursor: pointer;
        color: rgb(68, 68, 68);
    }

    .type-box {
        width: 15px;
        height: 15px;
        border-radius: 4px;
        cursor: pointer;
        border: 2px solid transparent;
        transition: transform 0.1s ease, border 0.1s ease;
    }

    .type-box:hover {
        transform: scale(1.1);
    }

    .type-radio:checked + .type-box {
        border: 2px solid black;
    }

    tbody tr {
        cursor: pointer;
    }

    .selected-row {
        background-color: #d1e7dd !important;
    }

</style>

<script>
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const uploadForm = document.getElementById('uploadForm');
    const spinner = document.getElementById('spinner');
    const downloadBtn = document.getElementById('downloadBtn');
    const selectionForm = document.getElementById('selectionForm');
    const checkboxes = document.querySelectorAll('.item-checkbox');
    const selectAll = document.getElementById('selectAll'); 
    const deselectAll = document.getElementById('deselectAll');

    selectAll.addEventListener('click', () => {
        checkboxes.forEach(checkbox => { checkbox.checked = true; });
    });
    deselectAll.addEventListener('click', () => {
        checkboxes.forEach(checkbox => { checkbox.checked = false; });
    });

    document.querySelectorAll('tbody tr').forEach(row => {
        row.addEventListener('click', function (e) {
            if (e.target.closest('input') || e.target.closest('label')) {
                return;
            }
            const checkbox = this.querySelector('.item-checkbox');
            if (checkbox) {
                checkbox.checked = !checkbox.checked;

                if (checkbox.checked) {
                    this.classList.add('selected-row');
                }
                else {
                    this.classList.remove('selected-row');
                }
            }
        });
    });

    function filterSelected() {
        const rows = document.querySelectorAll('tbody tr');
        rows.forEach(row => {
            const checkbox = row.querySelector('.item-checkbox');
            if (checkbox && !checkbox.checked) {
                row.style.display = 'none';
            }
        });
    }


</script>
